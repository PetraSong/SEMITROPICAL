#!/usr/bin/env bash

# author: Sander W. van der Laan | s.w.vanderlaan-2@umcutrecht.nl
# last update: 2023-11-28

### Creating display functions
### Setting colouring
NONE='\033[00m'
BOLD='\033[1m'
# OPAQUE='\033[2m'
FLASHING='\033[5m'
# UNDERLINE='\033[4m'

RED='\033[01;31m'
# GREEN='\033[01;32m'
# YELLOW='\033[01;33m'
# PURPLE='\033[01;35m'
CYAN='\033[01;36m'
# WHITE='\033[01;37m'
### Regarding changing the 'type' of the things printed with 'echo'
### Refer to: 
### - http://askubuntu.com/questions/528928/how-to-do-underline-bold-italic-strikethrough-color-background-and-size-i
### - http://misc.flogisoft.com/bash/tip_colors_and_formatting
### - http://unix.stackexchange.com/questions/37260/change-font-in-echo-command

### echo -e "\033[1mbold\033[0m"
### echo -e "\033[3mitalic\033[0m" ### THIS DOESN'T WORK ON MAC!
### echo -e "\033[4munderline\033[0m"
### echo -e "\033[9mstrikethrough\033[0m"
### echo -e "\033[31mHello World\033[0m"
### echo -e "\x1B[31mHello World\033[0m"

# for i in $(seq 0 5) 7 8 $(seq 30 37) $(seq 41 47) $(seq 90 97) $(seq 100 107) ; do 
# 	echo -e "\033["$i"mYou can change the font...\033[0m"; 
# done
### Creating some function
# function echobold { #'echobold' is the function name
#     echo -e "\033[1m${1}\033[0m" # this is whatever the function needs to execute.
# }
function echocyan { #'echobold' is the function name
    echo -e "${CYAN}${1}${NONE}" # this is whatever the function needs to execute.
}
function echobold { #'echobold' is the function name
    echo -e "${BOLD}${1}${NONE}" # this is whatever the function needs to execute, note ${1} is the text for echo
}
function echoitalic { #'echobold' is the function name
    echo -e "\033[3m${1}\033[0m" # this is whatever the function needs to execute.
}
function echowarning { #'echobold' is the function name
    echo -e "${FLASHING}${RED}${1}${NONE}" # this is whatever the function needs to execute.
}

# Help function
function show_help {
  echocyan "Usage: $0 [-s|--stain STAIN]"
  echocyan "Copy whole-slide images (WSI) for a specific stain from bulk to virtual slides directory."
  echocyan
  echocyan "This one is SPECIFICALLY for CD34 counterstained with DAB."
  echocyan
  echocyan "Options:"
  echocyan "  -s, --stain STAIN    Specify the stain type (e.g., CD14, CD3, EVG, etc.). Default is HE."
  echocyan "  -h, --help           Display this help and exit."
  echocyan
  echocyan "Description:"
  echocyan "This script copies whole-slide images (WSI) for a specified stain from a bulk directory"
  echocyan "to a virtual slides directory. It uses a list of sample numbers for CEA patients and"
  echocyan "performs the copy operation for each sample. The stain type can be customized using the -s or --stain option."
  exit 0
}

# Here we set the list of samples selected for the analyses
# These are 2,461 CEA patients with the proper informed consent
SAMPLE_LIST="4609 916 411 165 906 1527 797 1868 999 1789 335 247 421 1798 565 1405 1317 268 2648 869 201 1268 546 315 493 948 1914 1648 688 606 1663 1370 1237 1231 1750 867 77 125 1756 458 1095 1568 1242 706 1676 1297 186 769 947 67 861 1763 1794 1347 1439 1692 1004 430 1032 1019 124 988 747 1111 969 173 1702 137 1705 1629 1578 678 1385 197 307 189 435 1125 1337 1683 188 121 374 1410 485 1323 624 237 1749 1745 33 1716 12 1783 1227 1217 1057 104 1469 557 150 85 1361 1790 298 1703 1163 1618 4215 172 1494 27 499 607 1765 1506 1080 2652 1598 380 1462 1655 764 146 395 1766 1010 919 1448 1540 1022 1634 1358 245 669 708 1272 1182 1728 376 723 204 928 1359 923 1267 308 1470 1940 131 97 164 291 416 932 981 1173 394 1589 1895 795 1590 1704 365 408 1545 1943 128 403 1271 1548 329 72 2856 1078 1514 1688 297 573 687 112 314 491 62 431 79 81 1344 192 2627 1066 465 3146 1679 1254 1404 410 390 366 1085 91 832 65 1427 796 1719 1390 1509 301 635 1586 2107 1594 681 333 273 1722 638 897 116 1735 103 608 1528 1671 1161 107 1334 136 1108 992 224 129 487 697 1483 595 1025 248 327 1167 1362 255 781 1332 1342 2807 1189 3282 494 1260 379 362 4305 1001 1179 793 2054 865 492 340 1567 792 249 637 82 1699 456 1909 640 102 1386 1074 1484 696 106 171 1431 676 2211 1743 1959 16 1162 49 1229 520 510 725 683 1068 783 601 37 1357 958 1403 114 757 1030 822 1288 1661 74 1879 1015 402 1185 994 1531 1607 973 1931 117 133 1199 439 1897 820 1343 1792 926 199 791 1788 661 1787 407 446 182 1796 540 752 1478 972 1754 1739 1815 1523 57 263 109 883 5 1604 1151 120 1461 1659 1758 1915 36 397 213 568 986 1378 1673 178 1487 671 52 13 900 363 265 989 1672 423 323 609 1412 39 1645 1471 1954 1938 1816 1635 110 6 48 285 905 1530 2642 622 292 2105 1723 754 1169 1178 266 1504 907 1917 779 839 531 420 996 1576 194 1685 685 92 1800 538 309 748 123 83 1718 1054 149 699 855 503 1222 877 1029 758 555 1919 331 230 69 931 1926 933 1194 336 1228 1203 130 2102 690 1145 50 225 1558 1764 698 1650 1305 1372 631 648 765 467 1376 443 235 665 724 956 1691 96 1126 763 893 2193 1253 1468 1505 250 1041 19 1205 441 1428 1216 564 1250 1055 462 270 1302 1100 460 1498 1571 1329 196 1495 1721 84 63 1341 1534 936 1243 1525 693 1713 9 1426 90 115 1188 1300 2343 401 479 1490 1257 857 1441 170 562 808 1565 770 260 486 532 1896 1239 975 279 166 998 1326 1299 1221 29 176 1369 1258 1738 334 1421 1026 337 175 507 459 1932 1898 1778 286 1224 858 613 481 222 489 1375 147 1795 878 151 179 655 174 1669 1345 1489 844 1740 469 1466 208 8 1186 1264 913 1286 1411 516 1643 34 518 875 1622 468 929 709 572 1751 321 1181 191 813 207 1597 58 1303 1331 1464 1132 756 239 24 413 283 56 1585 41 1249 1135 1768 1033 53 305 1472 254 30 1687 1519 528 574 1053 815 209 1552 119 108 1306 1184 852 388 1387 306 60 1956 915 1852 1088 324 495 2774 312 641 1706 272 234 753 1311 1617 1856 59 1296 1724 1018 1850 1858 75 1547 940 231 203 2033 422 1407 1207 563 525 1389 3 1771 1770 1218 1884 664 1642 1454 200 144 561 252 1287 1647 1133 1153 511 438 1011 1233 1425 599 1872 498 917 585 1230 1086 767 145 399 68 1780 1446 1367 1690 76 526 982 1429 105 1731 1380 761 45 311 616 158 985 11 1082 1285 216 692 1049 42 1549 1668 1675 240 628 1708 1636 1402 349 1058 1045 1619 243 1616 463 1732 1710 843 88 1689 1191 888 1352 730 1206 1910 1755 1651 615 2025 544 214 826 885 1654 552 35 406 549 647 66 21 921 1397 275 737 567 968 220 284 1775 183 1555 205 768 519 1140 1349 3334 350 1707 1406 1657 1781 938 1422 1891 1190 1383 1212 377 1696 78 751 4326 1374 71 960 385 911 1748 4575 54 303 530 28 483 238 1408 1601 256 667 542 135 496 1925 583 368 1714 1304 405 259 1658 659 551 942 1319 1262 995 1160 2 43 1855 873 1497 1639 1630 1510 1712 930 1265 1682 1174 1139 978 1398 884 445 370 850 138 1198 1878 1166 226 1409 1294 1725 1293 206 22 476 288 1321 646 663 473 450 904 946 1774 1210 1935 2283 185 2508 98 1413 644 428 7 1354 662 670 317 1701 1373 887 660 99 1873 838 2113 1017 23 627 1652 1933 1232 490 15 1544 684 253 318 1573 987 602 1301 990 143 1762 1445 2004 1414 1500 1928 939 400 262 113 1479 1282 87 1447 18 1391 909 271 860 1793 1903 475 448 246 1574 922 1335 738 251 274 44 398 269 514 484 127 1759 180 300 1449 1499 1274 282 1106 3673 480 837 287 40 1913 1065 1453 278 466 1322 353 569 404 1532 1012 1197 1747 4103 1452 1553 86 126 1071 1517 4 355 1394 1593 894 354 1918 64 1811 1460 872 1905 320 1656 866 1436 593 1773 1524 778 522 1320 1737 89 100 195 1420 1550 160 93 1717 918 1870 326 2370 1219 1324 1157 241 1869 679 1963 2103 1964 2106 1968 1969 1962 1955 2109 2043 1950 1948 3217 1949 2037 2039 2040 2041 2042 2023 2024 1976 2027 1818 140 2030 1238 1529 1977 1980 1982 1985 1986 1987 1990 2010 2371 2152 2156 2157 2158 2160 2161 2162 2159 2163 2013 2014 2015 2016 2005 2007 2127 2128 2072 2164 2169 2125 2170 2173 2175 2176 2179 2003 2009 2011 2073 2197 2133 2061 2187 2188 2189 2190 2184 2181 2183 2186 2131 2135 2136 2137 2382 2139 2192 2194 2195 2196 2200 2198 2132 2965 2141 2138 2142 2143 2055 2067 2068 2432 2140 2115 1821 2065 2207 2208 2117 2118 2147 2149 2148 2119 2210 2122 2121 2120 2251 2077 2144 2218 1989 1822 2255 2253 1907 1827 2258 2095 2089 2091 2083 2081 2082 1823 2254 2259 2306 2304 2260 2355 2314 2309 2086 2364 2360 2363 2362 2361 2359 2357 2356 2316 2315 2319 2305 2311 2262 2263 2301 2266 2365 2366 2367 2274 2265 2276 2277 2279 2278 2318 2280 2281 2217 2252 2368 2324 2325 2282 2328 2378 2372 2373 2287 2261 2375 2376 2225 2327 2289 2374 2380 2379 2336 2337 2381 2293 2292 2295 2296 2294 2298 2297 2342 2385 2341 2340 2347 2348 2349 2350 2227 2299 2387 2498 2499 2496 2389 2495 2268 2228 2388 2271 2272 2435 2270 2269 2491 2500 2433 2430 2393 2429 2229 2428 2488 2487 2394 4268 2427 2475 2483 2453 2447 1831 2613 2467 2466 2448 2449 2425 2445 2470 2462 2465 2424 2423 2444 4485 2455 2457 2602 1836 2422 2418 2420 2417 4131 2458 2416 2414 2411 2412 2833 2440 2439 2561 3747 2987 2409 2556 2438 2601 2405 2603 2404 2403 2400 2402 2631 2577 2570 2569 2529 2555 2632 2633 2579 1838 1840 2635 2636 2634 2637 2605 2608 2614 2639 2640 2611 2612 2610 2609 2502 2503 2586 2572 2604 2615 2616 2617 2618 2621 2622 2626 2628 2625 2249 2645 2597 2740 2710 2741 2501 2743 2744 2646 2647 2702 2703 2629 2745 2746 2714 2720 2715 2749 2903 2752 2728 2736 2727 2754 2755 2738 2757 2756 2750 2751 2737 2653 3689 2761 2655 2654 2726 2735 2732 2589 2806 2810 2809 2759 2762 3015 2708 2763 2659 2658 3532 2824 2823 2666 2667 2504 2505 2507 2506 2668 2669 2764 2915 2670 2766 2829 2671 2767 2832 2768 2672 2841 2838 2675 2769 2770 2771 2909 2673 2674 2849 2687 2851 2918 2848 2772 2679 3138 2677 2678 2785 2680 2773 3826 2649 2747 2685 2683 2858 2862 2688 2689 2864 2650 2950 2686 2866 2867 2871 3346 2691 2875 2884 2878 2951 2883 3037 2693 2955 2954 3258 2956 2890 2952 2697 2696 2957 2961 2962 2895 2699 2698 2978 3005 2947 2525 2982 2968 2964 2938 2983 2928 2929 2935 2934 2936 2891 2888 2889 2975 2976 2937 2925 3007 2980 3010 2970 3009 3848 3101 3102 2969 2973 2972 2967 2971 2528 2966 2981 3103 3104 3105 2948 2520 3106 3011 2943 3012 2992 3756 2932 3153 3154 3155 3156 3157 3158 3162 2995 4012 2990 2991 3014 2974 3141 3176 3177 3757 3053 3064 2543 2532 3142 3144 3107 3108 3143 3145 2924 3052 3151 3166 3167 3168 3759 3171 3174 3175 3201 3202 3110 3109 3068 3115 3114 3121 2999 3112 3116 3117 3118 3018 3119 3122 3120 3031 3034 3123 3124 3125 3126 3058 3499 3127 3128 3081 3078 3080 3073 3781 3133 3085 3097 3136 3134 3020 2533 3089 3022 3059 3042 3023 3043 3922 3046 3220 3221 3219 3383 3252 3250 3049 3251 3253 3255 3139 3254 3215 3228 3232 3135 2536 3047 2535 3256 3257 3216 3235 2881 3354 3356 3357 3358 3360 3365 3369 3372 3380 3381 3382 3259 3260 3384 3261 3285 3243 3246 3147 3148 3245 3242 3289 3288 3287 3178 3286 3149 3291 3292 3300 3301 3302 3304 3050 3305 3306 3263 3150 3240 3277 3406 3407 3295 3386 3391 3417 3408 2538 3294 3297 3419 3311 3420 3312 3421 4647 3463 3262 3299 3298 2539 3431 3430 3432 3316 3318 3401 3319 3402 3403 2540 3502 3504 3505 3508 3509 3514 3516 3518 3519 3520 3521 3524 3530 3433 3434 3435 3456 3455 3451 3264 3404 3448 2541 3410 3439 3476 3428 3427 3441 3265 3477 3483 3429 3449 3576 3442 3443 3444 3579 3266 3473 3538 3539 3486 3488 3269 3332 3489 3492 3543 3544 3545 3416 3415 3405 3267 2542 3440 3496 3335 3446 3445 3336 3412 3607 3618 3413 3414 3447 3609 3268 3497 3501 3561 3564 3568 3574 3575 3595 3606 3411 3409 3611 3627 3571 3641 3596 3597 3612 3610 3629 2545 2546 3620 3599 3594 3613 3615 3614 3342 3602 3604 3680 3679 3701 3702 3703 3709 3682 3270 3681 3617 3619 3558 3687 3688 3690 3691 3344 4157 3694 3697 3646 3647 3645 3654 3643 3699 3755 3754 3751 3753 3660 3662 3762 3760 3671 3731 3734 3733 3764 3763 3767 3766 3772 3769 3770 3771 3186 3188 3189 3190 3191 3193 3197 3729 3675 3674 3727 3637 3775 3774 3773 3778 3776 3777 3573 3780 3783 3784 3785 3786 3795 3796 3797 3800 3829 3717 3718 3720 3722 3724 3788 3738 3741 3833 3834 3835 3836 3676 3789 3616 3787 3350 3855 3837 3856 3790 3746 3839 3857 4129 3792 3793 3805 3806 3809 3844 3845 3846 3847 3851 3876 3852 3878 3840 3877 3740 3896 3820 3900 3901 3888 3889 3890 3891 3892 3893 3895 3880 3903 3935 3904 3905 3816 3866 3936 3907 3909 3910 3881 3894 3946 3906 3914 3868 3916 3917 3918 3920 3921 3822 3953 3956 3957 3886 3885 3884 3924 3887 3794 4000 4002 4003 4001 4031 4015 3979 3982 3986 4016 3869 3962 4037 4045 4048 4049 4050 4008 4005 4006 4007 4021 4022 4029 3994 4101 4102 4104 4105 4106 4141 4108 4109 4110 4112 4113 4114 4115 4116 4117 4118 4119 4120 4121 4122 4123 4124 4125 4126 4127 4128 4130 4132 4134 4135 4136 4137 4138 4139 4161 4162 4163 4177 4143 4145 4146 4180 4181 4178 4182 4183 4184 4185 4176 4133 3817 4186 4188 4175 4172 4173 4174 4169 4170 4171 4165 4166 4167 4195 4164 4194 4168 4193 4189 4190 4198 4196 4197 4192 4203 4204 4200 4201 4205 4206 4208 4209 4211 4600 4216 4218 4219 4220 4221 4222 4227 4228 4229 4231 4236 4237 4234 4235 4243 4244 4245 4249 4250 4251 4247 4248 4252 4253 4254 4255 4256 4257 4259 4260 4261 4191 4264 4265 4266 4267 4274 4275 4776 4276 4278 4279 4281 4282 4283 4284 4285 4289 4293 4296 4298 4300 4335 4314 4286 4295 4299 4307 4315 4318 4316 4321 4322 4446 4324 4325 4327 4328 4329 4308 4309 4310 4320 4151 4330 4331 4333 4339 4334 4337 4340 4351 4353 4354 4475 4359 4362 4363 4357 4360 4361 4365 4366 4368 4369 4370 4371 4373 4376 4270 4374 4342 4377 4378 4379 4380 4382 4383 4384 4385 4386 4387 4388 4389 4390 4412 4395 4411 4396 4414 4415 4416 4417 4317 4367 4413 4404 4420 4421 4422 4423 4424 4356 4375 4426 4427 4429 4430 4431 4433 4434 4435 4436 4437 4438 4439 4440 4441 4442 4443 4444 4445 4447 4449 4450 4451 4452 4453 4455 4456 4457 4458 4459 4454 4470 4471 4472 4476 4473 4425 4432 4477 4479 4481 4482 4483 4484 4486 4490 4474 4448 4491 4488 4489 4493 4496 4497 4498 4500 4502 4501 4512 4513 4514 4515 4517 4518 4519 4520 4521 4523 4525 4526 4528 4529 4530 4532 4534 4539 4540 4541 4398 4410 4463 4469 4535 4536 4759 4543 4546 4545 4571 4544 4547 4548 4551 4552 4553 4554 4555 4556 4559 4572 4573 4576 4579 4580 4581 4582 4583 4706 4585 4590 4593 4592 4589 4604 4605 4603 4602 4597 4598 4599 4596 4595 4594 4577 4591 4569 4567 4635 4588 4606 4631 4632 4562 4009 4550 4563 4601 4610 4634 4637 4638 4639 4640 4641 4642 4643 4644 4645 4649 4650 4651 4652 4653 4654 4655 4656 4658 4659 4011 4621 4662 4664 4665 4666 4669 4670 4672 4677 4679 4681 4682 4683 4684 4685 4686 4674 4688 4689 4690 4692 4693 4696 4697 4699 4702 4703 4704 4707 4709 4710 4711 4712 4713 4714 4715 4717 4718 4720 4721 4722 4723 4725 4727 4728 4729 4730 4732 4733 4735 4736 4738 4739 4740 4741 4742 4744 4745 4746 4676 4750 4762 4756 4764 4765 4767 4768 4769 4770 4771 4772 4773 4775 4777 4779 4780 4781 4785 4788 4789 4793 4796 4798 4800 4801 4802 4803 4804 4805 4806 4763 4795 1"

# Here we set some directories
BULKDIR="/data/isi/d/dhl/ec/VirtualSlides/AE-SLIDES/"
VIRTUALSLIDESDIR="/hpc/dhl_ec/VirtualSlides"
WORKDIR="_images_dropzone"

# Here we copy for a given stain the slides from the bulk directory to the virtual slides directory
# Stains are:
    # CD14
    # CD3
    # CD31
    # CD34
    # CD3_CD56_NKT
    # CD42B
    # CD66b
    # CD68
    # CD8
    # EVG
    # FIBRIN
    # GLYCC
    # HE
    # HE-FIBRIN
    # HHIPL1
    # MPO
    # MT
    # SMA
    # SR
    # SR_POLARIZED
    # VONWILLEBRANDFACTOR

# Check if any command line options are provided
if [ "$#" -eq 0 ]; then
  echo "Error: No options provided. Use -h or --help for usage information."
  exit 1
fi

# Command line options
while [[ "$#" -gt 0 ]]; do
  case $1 in
    -s|--stain)
      STAIN="$2"
      shift
      ;;
    -h|--help)
      show_help
      ;;
    *)
      echo "Unknown option: $1" >&2
      exit 1
      ;;
  esac
  shift
done

# Set default stain if not provided
STAIN="${STAIN:-HE}"

echo "Creating the [$WORKDIR] directory in the [$STAIN] folder."
if [ ! -d $VIRTUALSLIDESDIR/$STAIN/$WORKDIR ]; then
	mkdir $VIRTUALSLIDESDIR/$STAIN/$WORKDIR
else
	echo "[$WORKDIR] directory exists -- skipping"
fi

echo "Start the copying of WSI for [$STAIN]."
for STUDYNUMBER in $SAMPLE_LIST; do

    echo "> Copying slides for studynumber [AE${STUDYNUMBER}] and stain [${STAIN}]"
    ### Uncomment the following line to perform the actual copy
    cp -v $BULKDIR/$STAIN/_*_DAB/AE${STUDYNUMBER}.* $VIRTUALSLIDESDIR/$STAIN/$WORKDIR/
    ### reference to https://www.digitalocean.com/community/tutorials/how-to-use-rsync-to-sync-local-and-remote-directories
    ### --delete: In order to keep two directories truly in sync, itâ€™s necessary to delete files 
    ###         from the destination directory if they are removed from the source. 
    ###         By default, rsync does not delete anything from the destination directory.
    ### --partial: Tells rsync to keep partially transferred files (and upon resume 
    ###         rsync will use partially transferred files always after checksumming safely)
    ### --progress: This option tells rsync to print information showing the progress of the transfer.
    ### --human-readable/-h: Output numbers in a more human-readable format.
    ### --archive/-a: This is equivalent to -rlptgoD. It is a quick way of saying you want recursion 
    ###         and want to preserve almost everything (with -H being a notable omission). 
    ###         The only exception to the above equivalence is when --files-from is specified, 
    ###         in which case -r is not implied.
    ### --verbose/-v: This option increases the amount of information you are given during the transfer.
    ### --compress/-z: With this option, rsync compresses the file data as it is sent to the destination machine, 
    ###         which reduces the amount of data being transmitted -- something that is useful over a slow connection.
    # rsync -avz --progress --partial --delete -h $BULKDIR/$STAIN/AE${STUDYNUMBER}.* $VIRTUALSLIDESDIR/$STAIN/$WORKDIR/

done

